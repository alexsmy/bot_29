

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Звонок</title>
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/call.css">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div id="app-container">
        <div id="pre-call-check-screen" class="screen">
            <div class="check-container">
                <h1 class="check-title">Проверка оборудования</h1>
                <p class="check-subtitle">Разрешите доступ к камере и микрофону, чтобы начать.</p>
                <div class="media-preview-area">
                    <video id="previewVideo" autoplay muted playsinline></video>
                    <div class="mic-level-meter">
                        <div class="mic-level-bar"></div><div class="mic-level-bar"></div><div class="mic-level-bar"></div><div class="mic-level-bar"></div><div class="mic-level-bar"></div>
                    </div>
                </div>
                <div class="compact-grid status-indicators">
                    <div id="camera-status" class="status-item status-error"><span id="camera-status-text">Камера: ...</span></div>
                    <div id="mic-status" class="status-item status-error"><span id="mic-status-text">Микрофон: ...</span></div>
                </div>
                <div class="compact-grid device-selectors">
                    <div class="device-selector" id="camera-select-container"><label for="camera-select">Камера</label><select id="camera-select"></select></div>
                    <div class="device-selector" id="mic-select-container"><label for="mic-select">Микрофон</label><select id="mic-select"></select></div>
                    <div class="device-selector" id="speaker-select-container"><label for="speaker-select">Динамик</label><select id="speaker-select"></select></div>
                </div>
                <p id="ios-audio-permission-note" class="ios-note">На iOS для корректной работы громкой связи может потребоваться первоначальный доступ к камере, даже для аудиозвонка.</p>
                <button id="continue-to-call-btn" class="continue-btn" disabled>Продолжить</button>
                <button id="continue-spectator-btn" class="continue-btn spectator" style="display: none;">Войти без камеры и микрофона</button>
            </div>
        </div>

        <div id="pre-call-screen" class="screen">
            <div class="pre-call-header">
                <h1>Комната для звонка</h1>
                <p>Ожидание подключения собеседника...</p>
            </div>
            <div class="pre-call-center">
                <div id="popup-waiting" class="popup">
                    <h2>Ожидание...</h2>
                    <p>Поделитесь ссылкой на эту комнату, чтобы начать разговор. Как только собеседник присоединится, вы сможете ему позвонить.</p>
                    <div class="spinner"></div>
                </div>
                <div id="popup-actions" class="popup">
                    <h2>Собеседник в комнате!</h2>
                    <p>Выберите тип звонка, чтобы начать разговор.</p>
                    <div class="call-actions-container">
                        <button class="action-call-btn audio" data-call-type="audio"><span data-icon-name="audioCall"></span> Аудиозвонок</button>
                        <button class="action-call-btn video" data-call-type="video"><span data-icon-name="videoCall"></span> Видеозвонок</button>
                    </div>
                </div>
                <div id="popup-initiating" class="popup">
                    <h2>Собеседник занят</h2>
                    <p>Похоже, ваш собеседник уже пытается вам позвонить или находится в процессе звонка. Пожалуйста, подождите.</p>
                    <div class="spinner"></div>
                </div>
            </div>
            <div class="pre-call-footer">
                <div class="info-block-lifetime">
                    <p>Эта комната будет активна еще:</p>
                    <div id="lifetime-timer">--:--</div>
                    <div class="footer-actions">
                        <button id="close-session-btn">Закрыть комнату</button>
                        <button id="instructions-btn">Инструкция</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="call-screen" class="screen">
            <video id="remoteVideo" autoplay playsinline></video>
            <div id="local-video-container">
                <video id="localVideo" autoplay muted playsinline></video>
                <div class="view-controls">
                    <button id="toggle-local-view-btn" class="view-control-btn" title="Изменить вид моего видео"><span class="icon" data-icon-name="localViewContain"></span></button>
                    <button id="toggle-remote-view-btn" class="view-control-btn" title="Изменить вид видео собеседника"><span class="icon" data-icon-name="remoteViewCover"></span></button>
                </div>
            </div>
            <div id="audio-call-visualizer">
                <div id="local-avatar" class="avatar-container local">
                    <div class="glow" id="local-glow"></div>
                    <span data-icon-name="audioAvatarLocal"></span>
                </div>
                <div class="data-flow"><span></span><span></span><span></span><span></span><span></span></div>
                <div id="remote-avatar" class="avatar-container remote">
                    <div class="glow" id="remote-glow"></div>
                    <span data-icon-name="audioAvatarRemote"></span>
                </div>
            </div>
            <div class="call-ui-overlay">
                <div class="top-info">
                    <div id="connection-status" title="Качество соединения / Тип соединения">
                        <div id="connection-quality">
                            <span id="quality-good-svg" class="quality-svg" data-icon-name="qualityGood"></span>
                            <span id="quality-medium-svg" class="quality-svg" data-icon-name="qualityMedium"></span>
                            <span id="quality-bad-svg" class="quality-svg" data-icon-name="qualityBad"></span>
                        </div>
                        <span id="conn-local" class="icon" data-icon-name="connLocal"></span>
                        <span id="conn-p2p" class="icon" data-icon-name="connP2P"></span>
                        <span id="conn-relay" class="icon" data-icon-name="connRelay"></span>
                        <span id="conn-unknown" class="icon active" data-icon-name="connUnknown"></span>
                        <div id="connection-info-popup"></div>
                    </div>
                    <div id="remote-audio-level" class="remote-audio-level-container">
                        <div class="remote-audio-level-bar"></div><div class="remote-audio-level-bar"></div><div class="remote-audio-level-bar"></div><div class="remote-audio-level-bar"></div><div class="remote-audio-level-bar"></div>
                    </div>
                </div>
                <div class="center-info">
                    <div class="caller-info-top">
                        <h2 id="remote-user-name">Собеседник</h2>
                        <p id="call-timer">00:00</p>
                    </div>
                </div>
                <div class="bottom-controls">
                    <div class="call-controls-grid">
                        <div class="control-item">
                            <button id="speaker-btn" class="control-btn"><span class="icon-on" data-icon-name="speakerOn"></span><span class="icon-off" data-icon-name="speakerOff"></span></button>
                            <span>Динамик</span>
                        </div>
                        <div class="control-item">
                            <button id="mute-btn" class="control-btn"><span class="icon-on" data-icon-name="micOn"></span><span class="icon-off" data-icon-name="micOff"></span></button>
                            <span>Микрофон</span>
                        </div>
                        <div class="control-item" id="video-control-item">
                            <button id="video-btn" class="control-btn"><span class="icon-on" data-icon-name="videoOn"></span><span class="icon-off" data-icon-name="videoOff"></span></button>
                            <span>Камера</span>
                        </div>
                        <div class="control-item" id="screen-share-control-item">
                            <button id="screen-share-btn" class="control-btn"><span class="icon-on" data-icon-name="screenShareOn"></span><span class="icon-off" data-icon-name="screenShareOff"></span></button>
                            <span>Экран</span>
                        </div>
                        <div class="control-item">
                            <button id="device-settings-btn" class="control-btn"><span class="icon-on" data-icon-name="settings"></span></button>
                            <span>Настройки</span>
                        </div>
                    </div>
                    <div class="hangup-wrapper">
                        <button id="hangup-btn" class="hangup-btn"><span data-icon-name="hangup"></span></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="incoming-call-modal" class="modal">
        <div class="modal-content">
            <div class="caller-info-modal">
                <h1 id="caller-name">Собеседник</h1>
                <p id="incoming-call-type">Входящий звонок</p>
            </div>
            <div class="modal-buttons">
                <div class="action-button-wrapper">
                    <button id="decline-btn" class="action-btn decline-btn"><span data-icon-name="decline"></span></button>
                    <span>Отклонить</span>
                </div>
                <div class="action-button-wrapper">
                    <button id="accept-btn" class="action-btn accept-btn"><span data-icon-name="accept"></span></button>
                    <span>Принять</span>
                </div>
            </div>
        </div>
    </div>

    <div id="instructions-modal" class="modal-instructions">
        <div class="modal-overlay"></div>
        <div class="modal-instructions-content">
            <button class="close-instructions-btn top">Закрыть</button>
            <div class="instructions-content">
                {{- '' -}}
            </div>
            <button class="close-instructions-btn bottom">Закрыть</button>
        </div>
    </div>

    <div id="device-settings-modal" class="modal-instructions">
        <div class="modal-overlay"></div>
        <div class="modal-instructions-content">
            <div class="settings-content">
                <h2>Настройки устройств</h2>
                <div class="device-selectors-modal">
                    <div class="device-selector" id="camera-select-container-call"><label for="camera-select-call">Камера</label><select id="camera-select-call"></select></div>
                    <div class="device-selector" id="mic-select-container-call"><label for="mic-select-call">Микрофон</label><select id="mic-select-call"></select></div>
                    <div class="device-selector" id="speaker-select-container-call"><label for="speaker-select-call">Динамик</label><select id="speaker-select-call"></select></div>
                </div>
            </div>
            <button class="close-settings-btn bottom">Закрыть</button>
        </div>
    </div>

    <div id="remote-mute-toast" class="toast-notification"></div>
    <div id="connection-toast" class="toast-notification"></div>

    <audio id="localAudio" autoplay muted playsinline></audio>
    <audio id="remoteAudio" autoplay playsinline></audio>
    <audio id="ringOutAudio" src="/static/sounds/ring-out.mp3" loop></audio>
    <audio id="ringInAudio" src="/static/sounds/ring-in.mp3" loop></audio>
    <audio id="connectAudio" src="/static/sounds/connect.mp3"></audio>

    <script src="/static/js/icons.js"></script>
    <script type="module" src="/static/js/main.js"></script>
</body>
</html>